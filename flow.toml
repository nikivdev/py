version = 1
name = "py"

[[tasks]]
name = "setup"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  echo "Install uv from https://docs.astral.sh/uv/getting-started/installation/"
  exit 1
fi

"$uv_bin" --version >/dev/null
export UV_PYTHON="${UV_PYTHON:-$python_spec}"

set +e
uv_output="$("$uv_bin" sync --python "$python_spec" 2>&1)"
status=$?
set -e

if [ $status -ne 0 ]; then
  printf '%s\n' "$uv_output" >&2
  exit $status
fi

echo "✔️ you are setup"
"""
description = "Ensure uv-managed Python is available and install dependencies."

[[tasks]]
name = "dev"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  echo "Install uv from https://docs.astral.sh/uv/getting-started/installation/"
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m cli.flow "$@"
"""
description = "Run the Flow CLI (passes CLI args through)."

[[tasks]]
name = "snapvision"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  echo "Install uv from https://docs.astral.sh/uv/getting-started/installation/"
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m cli.snapvision "$@"
"""
description = "Quickly run the SnapVision CLI (passes CLI args through)."

[[tasks]]
name = "uv-upgrade"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  echo "Install uv from https://docs.astral.sh/uv/getting-started/installation/"
  exit 1
fi

"$uv_bin" self update "$@"
"""
description = "Update the uv CLI to the latest available version."

[[tasks]]
name = "mlx-model-install"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  echo "Install uv from https://docs.astral.sh/uv/getting-started/installation/"
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" python mlx-model-install.py "$@"
"""
description = "Launch the TUI helper to download MLX models."

[[tasks]]
name = "claude-sdk"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  echo "Install uv from https://docs.astral.sh/uv/getting-started/installation/"
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m cli.claude_sdk "$@"
"""
description = "Run Claude SDK CLI (passes CLI args through)."

[[tasks]]
name = "deploy"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

INSTALL_DIR="${INSTALL_DIR:-$HOME/bin}"
mkdir -p "${INSTALL_DIR}"

# Sync dependencies first
"$uv_bin" sync --python "$python_spec"

# Get the venv bin path
VENV_BIN="$(pwd)/.venv/bin"

# Symlink claude-sdk
TARGET="${INSTALL_DIR}/claude-sdk"
echo "Linking ${TARGET} -> ${VENV_BIN}/claude-sdk"
rm -f "${TARGET}"
ln -s "${VENV_BIN}/claude-sdk" "${TARGET}"

echo "Deployed claude-sdk to ${TARGET}"
echo "Ensure ${INSTALL_DIR} is on your PATH"
"""
description = "Deploy claude-sdk CLI to ~/bin"

[[tasks]]
name = "infra"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m infra "$@"
"""
description = "Prime Intellect GPU provisioning CLI"

[[tasks]]
name = "mlx"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m learn_mlx."${1:-basics}" "${@:2}"
"""
description = "Run MLX learning modules (basics, internals, training)"

[[tasks]]
name = "neurips"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m scrape.neurips "$@"
"""
description = "Scrape NeurIPS papers (--limit N, --json, --year YYYY)"

[[tasks]]
name = "learn"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" python learn/"${1:-positional_encoding}".py "${@:2}"
"""
description = "Run learning scripts (positional_encoding, etc)"

[[tasks]]
name = "nn"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m learn.neural-networks."${1:-01_positional_encoding}" "${@:2}"
"""
description = "Run neural network lessons (01_positional_encoding, 02_attention, etc)"

[[tasks]]
name = "neurips2025"
command = """
set -euo pipefail
uv_bin="${UV_BIN:-uv}"
python_spec="${PYTHON_SPEC:-3.13}"

if ! command -v "$uv_bin" >/dev/null 2>&1; then
  echo "uv executable '$uv_bin' not found in PATH."
  exit 1
fi

export UV_PYTHON="${UV_PYTHON:-$python_spec}"
"$uv_bin" run --python "$python_spec" -m scrape.neurips2025 "$@"
"""
description = "Download NeurIPS 2025 papers + PDFs (--limit N, --pdfs-only, --delay N)"
